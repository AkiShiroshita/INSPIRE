---
title: "Assignment 2"
author: "Akihiro Shiroshita, Tebeb Gebretsadik, Tina V. Hartert"
description: Vanderbilt University
fontfamily: accanthis 
fontsize: 11pt       
linestretch: 1 
output: word_document
editor_options: 
  markdown: 
    wrap: 72
bibliography: references.bib
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
	echo = TRUE,
	message = FALSE,
	warning = FALSE,
	fig.pos="t",
	fig.height=4,
	out.extra=""
)

packages = c("devtools",
             "usethis",
             "here",
             "readr",
             "readxl",
             "expss",
             "tidyverse",
             "tidylog",
             "lubridate",
             "ggplot2",
             "ggplotgui",
             "ggthemes",
             "arsenal",
             "stats",
             "epitools",
             "DescTools",
             "epiR",
             "RVAideMemoire",
             "tableone",
             "flextable",
             "naniar",
             "VIM")
package.check <- lapply(packages, FUN = function(x){
  if (!require(x, character.only = TRUE)){
    install.packages(x, dependencies = TRUE)
    library(x, character.only = TRUE)
  }
})
```

1.  Restate your research question in the form of a testable hypothesis

**Research question**

Is the age at the first respiratory syncytial virus (RSV) infection
associated with the risk of subsequent child asthma inception? In this
assignment, more specifically, is RSV infection during the first year of
life associated with the risk of subsequent child asthma inception?

2.  In one or two paragraphs, state the study design for this specific
    project (this may be different from the design for the parent
    study). Be sure to describe the study population in terms of
    inclusion and exclusion criteria. Additionally, include any
    information about how participants were sampled/recruited, if
    applicable.

**Study design**

Our study was based on the prospective population-based birth cohort
study recruited from the middle Tennessee region of the southeastern
United States, the Infant Susceptibility to Pulmonary Infections and
Asthma Following RSV Exposure (INSPIRE) study. The INSPIRE cohort
consists of nearly 2,000 term and healthy infants followed from early
infancy through 6 years of age. RSV was defined through biweekly
surveillance during the first year of life, and asthma was defined at
age 5-6 years. Detailed methods have been previously published
[@larkin2015]. The current study was approved by the Institutional
Review Board at Vanderbilt University Medical Center. Written informed
consent was provided by a parent or legal guardian of an infant
participant. The INSPIRE study was funded by a National Institute of
Allergy and Infectious Diseases (NIAID) Asthma and Allergic Diseases
Cooperative Research Center (AADCRC) grant.

**Study participants**

INSPIRE study participants were recruited from regional pediatric
practices. Inclusion criteria were singleton birth; an infant who was
born between June and December of 2012 and 2013; term birth ≥37 weeks;
birth weight ≥2250 g (5 lbs); no intention of relocating from area
within 5 years. The restriction to birth months of June through December
was so that each infant would be on average 6 months of age or less
entering their first RSV season [@piedimonte2014]. The unique design of
this population-based cohort was to represent the complete spectrum
(mild to severe) of RSV infection, instead of only severe RSV infection,
to overcome the confounding effect of genetic predisposition to both
severe RSV infection and child asthma inception [@brunwasser2020].
Exclusion criteria were mechanical ventilation before enrolment, receipt
of RSV immunoprophylaxis and significant medical co-morbidities.

3.  In one paragraph, describe the exposure assessment and how it will
    be analyzed. For the purposes of this assignment, you should use
    either a dichotomous or categorical exposure variable. If your
    original exposure variable was continuous and you categorized it,
    what cut-points did you use to categorize your variables and why did
    you choose those cut points?

**Exposure**

For evaluating the association between age at the first RSV infection
and the outcomes, we restricted to RSV-infected participants who were
detected by nasal PCR to define infant age of infection in the first
year of life. Children who were RSV PCR negative and RSV serology
positive at age 1-year as RSV infected RSV infected during the first
year of life while those who were RSV PCR negative and RSV serology
negative at age 1-year as RSV infected after age one. This assumption is
reasonable because most children acquire first RSV infection in the
first 2 years of life [@piedimonte2014a].

4.  In one paragraph, describe the outcome assessment and how it will be
    analyzed. For the purposes of this assignment, you should use a
    dichotomous outcome variable. If the outcome is continuous or
    categorical, state how you decided to dichotomize it into the groups
    you chose.

**Outcome**

Current asthma at 5 years was defined by both 1) physician diagnosis by
5 years and 2) parental report of symptoms, systemic steroid use, or
healthcare utilization for asthma in prior 12 months. Annual recurrent
wheeze at 2,3,4 years was defined as parental report of ≥2 wheezing
episodes since the child's last birthday.

5.  Based on your literature review and any other substantive knowledge
    you have of the subject, list the potential confounders and effect
    modifiers you think should be included in the analysis of your
    exposure and outcome. Indicate whether all these confounders and
    modifiers are available in your dataset.

**Confounders**

Based on previous literature, we selected confouders. [@shi2020;
@coutts2020a] ![Direct acyclic graph](images/dag.svg)

**Effect modifier**

Viral co-infection and genetic influences are expected as effect
modifiers [@binns2022].

**Covariates**

Models were adjusted for the covariates chosen a priori based on their
clinical relevance as confounders or risk factors [@shi2020;
@coutts2020a]. Covariates included infant sex (male vs. female), child
race/ethnicity (White-non-Hispanic vs. all other ethnic and racial
groups), mode of delivery (vaginal vs. cesarean), maternal marital
status (married vs. single), maternal education, maternal or paternal
asthma status (absent vs. present), and insurance status (Medicaid vs.
all other insurance), breast feeding status, presence of sibling and day
care attendance in the first year of life.

**Comments**

Regarding confounders, our cohort study included all necessary
information. Regarding effect modification, our cohort study collected
the information, but in this assignment, we cannot access them. Instead,
we evaluated the effect modification of family history of asthma.

6.  Label all the variables in your dataset.
7.  For all categorical or dichotomous variables, add value labels for
    all groups.

```{r}
df <- read_csv(here("output/analysis_data.csv"))

df %>% glimpse()
df %>% colnames()

df <- df %>% 
  select(cfsubjid, STUDYENROLLDATE, INFANTDOB,
         # baseline characteristics (numeric)
         GESTAGEWK, BIRTHWEIGHT_GRAM, BREASTFEDDUR, OTHERLIVSIBS_BIO,
         OTHERLIVSIBS_HAL, HOUSEHOLDSIZE, MAT_EDUCYEARS,
         # baseline characteristics (categorical)
         sex, ethnicity, MATSMOKE_PREG, DAYCARE_OY, MAT_ASTHMA_EVER,
         PAT_ASTHMA_EVER, EVERBREASTFED, DELIVERYMODE, MAT_EDUC,
         MAT_MARITAL_STATUS, INSURANCE_CHILD, residence6mo,
         # exposure
         rftodaydate, # PCR sampling date
         anyrsv_dev, # RSV positive
         BSS2_dev, # severity
         oy_rsv_infected_dev, # PCR or serology positive
         rsv_exposed_dev, # serology,
         oysmpbldrschdate, # serology sampling date
         # outcome
         oyrecwhz2p_dev, tyrecwhz2p_dev, ryrecwhz2p_dev,
         fyrecwhz2p_dev, vyrecwhz2p_dev, xyrecwhz2p_dev,
         oy_rec_whz_dev, ty_rec_whz_dev, ry_rec_whz_dev,
         fy_rec_whz_dev, vy_rec_whz_dev, xy_rec_whz_dev,
         fycurrentasthma_dev, vycurrentasthma_dev
         ) %>% 
  apply_labels(GESTAGEWK = "Gestational age of infant at birth",
               BIRTHWEIGHT_GRAM = "Birth weight",
               BREASTFEDDUR = "Duration of breastfeeding (weeks)",
               OTHERLIVSIBS_BIO = "Number of biological siblings",
               OTHERLIVSIBS_HAL = "Number of half siblings",
               HOUSEHOLDSIZE = "Total number of people") %>% 
  mutate(# baseline characteristics
         sex = factor(sex, levels = c(0,1), labels = c("Female", "Male")),
         ethnicity = factor(ethnicity, levels = c(0,1,2), labels = c("Non-hispanic White", "Non-hispanic balck", "Hispanic and other")),
         MATSMOKE_PREG = factor(MATSMOKE_PREG, levels = c(0,1), labels = c("Not", "Maternal smoking during pregnancy")),
         DAYCARE_OY = factor(DAYCARE_OY, levels = c(0,1), labels = c("Not", "Daycase use furing the first year")),
         MAT_ASTHMA_EVER = factor(MAT_ASTHMA_EVER, levels = c(0,1), labels = c("Not", "Maternal asthma")),
         PAT_ASTHMA_EVER = factor(PAT_ASTHMA_EVER, levels = c(0,1), labels = c("Not", "Paternal asthma")),
         EVERBREASTFED = factor(EVERBREASTFED, levels = c(0,1), labels = c("Not", "Breast feeding")),
         DELIVERYMODE = factor(DELIVERYMODE, levels = c(0,1), labels = c("Vaginal", "C-section")),
         MAT_EDUC = factor(MAT_EDUC, levels = c(1,2,3,4), labels = c("less than HS/GED", "HS", "Some college", "College degree +")),
         MAT_MARITAL_STATUS = factor(MAT_MARITAL_STATUS, levels = c(1,2,3), labels = c("Single", "Married", "Divorces/Separated")),
         INSURANCE_CHILD = factor(INSURANCE_CHILD, levels = c(1,2,3,4,5), labels = c("Medicaid", "Private", "Self-Pay", "None", "Other")),
         residence6mo = factor(residence6mo, levels = c(0,1), labels = c("Rural", "Urban")),
         # exposure
         anyrsv_dev = factor(anyrsv_dev, levels = c(0,1), labels = c("RSV PCR positive", "Not")),
         oy_rsv_infected_dev = factor(oy_rsv_infected_dev, levels = c(0,1), labels = c("Not", "PCR or Serology positive")),
         rsv_exposed_dev = factor(rsv_exposed_dev, levels = c(0,1), labels = c("Not", "Serology positive")),
         # outcome
         oyrecwhz2p_dev = factor(oyrecwhz2p_dev, levels = c(0,1), labels = c("Not", "Recurrent wheeze of more than 2 episodes during the first year")),
         tyrecwhz2p_dev = factor(tyrecwhz2p_dev, levels = c(0,1), labels = c("Not", "Recurrent wheeze of more than 2 episodes  during the second year")),
         ryrecwhz2p_dev = factor(ryrecwhz2p_dev, levels = c(0,1), labels = c("Recurrent wheeze of more than 2 episodes  during the third year", "Not")),
         fyrecwhz2p_dev  = factor(fyrecwhz2p_dev , levels = c(0,1), labels = c("Not", "Recurrent wheeze of more than 2 episodes  during the fourth year")),
         vyrecwhz2p_dev = factor(vyrecwhz2p_dev, levels = c(0,1), labels = c("Not", "Recurrent wheeze of more than 2 episodes  during the fifth year")),
         xyrecwhz2p_dev = factor(xyrecwhz2p_dev, levels = c(0,1), labels = c("Not", "Recurrent wheeze of more than 2 episodes  during the sixth year")),
         fycurrentasthma_dev = factor(fycurrentasthma_dev, levels = c(0,1), labels = c("Not", "Five-year current asthma")),
         oy_rec_whz_dev = factor(oy_rec_whz_dev, levels = c(0,1), labels = c("Not", "Recurrent wheeze during the first year")),
         ty_rec_whz_dev = factor(ty_rec_whz_dev, levels = c(0,1), labels = c("Not", "Recurrent wheeze during the second year")),
         ry_rec_whz_dev = factor(ry_rec_whz_dev, levels = c(0,1), labels = c("Not", "Recurrent wheeze during the third year")),
         fy_rec_whz_dev = factor(fy_rec_whz_dev, levels = c(0,1), labels = c("Not", "Recurrent wheeze during the fourth year")),
         vy_rec_whz_dev = factor(vy_rec_whz_dev, levels = c(0,1), labels = c("Not", "Recurrent wheeze during the fifth year")),
         xy_rec_whz_dev = factor(xy_rec_whz_dev, levels = c(0,1), labels = c("Not", "Recurrent wheeze during the sixth year")),
         fycurrentasthma_dev = factor(fycurrentasthma_dev, levels = c(0,1), labels = c("Not", "Five-year current asthma")),
         vycurrentasthma_dev = factor(vycurrentasthma_dev, levels = c(0,1), labels = c("Not", "Six-year current asthma")),)
```

8.  Is there missing data in your dataset? If so, explain how missing
    values are coded and how they will be handled in the analysis.
    Summarize interesting missing data patterns.

```{r}
# overall missing

pct_miss(df)

# baseline characteristics

gg_miss_var(df %>% select(# baseline characteristics (numeric)
          GESTAGEWK, BIRTHWEIGHT_GRAM, BREASTFEDDUR, OTHERLIVSIBS_BIO,
          OTHERLIVSIBS_HAL, HOUSEHOLDSIZE,
          # baseline characteristics (categorical)
          sex, ethnicity, MATSMOKE_PREG, DAYCARE_OY, MAT_ASTHMA_EVER,
          PAT_ASTHMA_EVER, EVERBREASTFED, DELIVERYMODE,
          MAT_EDUCYEARS, MAT_MARITAL_STATUS, INSURANCE_CHILD, residence6mo)) +
  labs(title = "Participants' baseline characteristics")

# exposure  

gg_miss_var(df %>% select(rftodaydate, # PCR sampling date
         anyrsv_dev, # RSV positive
         BSS2_dev, # severity
         oy_rsv_infected_dev, # PCR or serology positive
         rsv_exposed_dev, # serology,
         oysmpbldrschdate)) +
  labs(title = "Exposure status")

# outcome

gg_miss_var(df %>% select(oyrecwhz2p_dev, tyrecwhz2p_dev, ryrecwhz2p_dev,
         fyrecwhz2p_dev, vyrecwhz2p_dev, xyrecwhz2p_dev,
         oy_rec_whz_dev, ty_rec_whz_dev, ry_rec_whz_dev,
         fy_rec_whz_dev, vy_rec_whz_dev, xy_rec_whz_dev,
         fycurrentasthma_dev, vycurrentasthma_dev)) +
  labs(title = "Outcome status")

gg_miss_upset(df %>% select(oyrecwhz2p_dev, tyrecwhz2p_dev, ryrecwhz2p_dev,
         fyrecwhz2p_dev, vyrecwhz2p_dev, xyrecwhz2p_dev,
         oy_rec_whz_dev, ty_rec_whz_dev, ry_rec_whz_dev,
         fy_rec_whz_dev, vy_rec_whz_dev, xy_rec_whz_dev,
         fycurrentasthma_dev, vycurrentasthma_dev))

# summary

miss_tab <- miss_var_summary(df)
miss_tab
```

Generally, missing data were coded as "NA".

Regarding exposure variables,

-   anyrsv_dev: 1-PCR positive, NA-missing + negative

-   rsv_exposed_dev: 1-serology positive, 0-negative, NA-missing

-   oy_rsv_infected_dev: 1-PCR or serology positive, 0-negative,
    NA-missing

**Missing data** INSPIRE cohort had only small percent of missing data
in participants' baseline characteristics. Regarding exposures, for
infants with RSV PCR positive we used the age at specimen collection.
For infants or children for which age of RSV infection is not
ascertained but known to be serology positive or negative, we assigned
RSV infected during the first year of life and RSV infected after age
one, respectively. Regarding outcomes, many outcome variables are
monotone missingness pattern, that is when the variable was missing,
then all other variables examined later were also missing.

9.  Table 0. Create a list of all the variables in your dataset,
    including exposure, outcome, covariates, confounders and effect
    modifiers. Include the following:

<!-- -->

a.  Variable name
b.  Variable label
c.  Variable type (continuous, categorical, dichotomous)
d.  Range for continuous variables OR unique values and value labels for
    categorical and dichotomous variables
e.  Percent missing

```{r}
vars <- df %>% 
  select(-cfsubjid, -STUDYENROLLDATE, -INFANTDOB) %>%
  colnames()
factorVars <- df %>% 
  select(-cfsubjid, -STUDYENROLLDATE, -INFANTDOB) %>%
  select(where(is.factor)) %>% 
  colnames()

table0 <- CreateTableOne(vars = vars,
                         data = df,
                         includeNA = FALSE,
                         factorVars = factorVars)
table0 %>% 
  print() %>% 
  write.csv(here("output/table0.csv"))
```

10. Create histograms for all continuous variables. Comment on outliers,
    skewed distributions (and whether/what transformation may be
    necessary)

```{r}
num_vars <- df %>% 
  select(GESTAGEWK, BIRTHWEIGHT_GRAM, BREASTFEDDUR,
         OTHERLIVSIBS_BIO, OTHERLIVSIBS_HAL, MAT_EDUCYEARS,
         BSS2_dev) %>% 
  colnames()

for (var in num_vars) {
  data <- df[, var] %>% unlist()
  hist(data,
       main=paste('Histogram of', var),
       xlab = paste(var))
}
```

The distributions of Infant's birth weight and maternal education are
similar to normal distribution. Regarding other variables, their
distributions are right-skewed. In the analysis, we categorized all
skewed variables into binary and handle maternal education as
continuous.

11. Table 1. Create a table with categories of your main exposure
    variable as the columns. If your study design is cohort or
    cross-sectional include all participants in your study, otherwise
    use only controls if your study is a case-control study. Compute
    descriptive statistics (frequencies and proportion for categorical
    variables and mean ± SD for continuous variables) for all potential
    confounders by categories of your main exposure.

```{r}
table1 <- CreateTableOne(vars = vars,
                         data = df %>% drop_na(oy_rsv_infected_dev),
                         includeNA = FALSE,
                         factorVars = factorVars,
                         strata = "oy_rsv_infected_dev")
table1 %>% 
  print() %>% 
  write.csv(here("output/table1.csv"))
```

12. Table 2. Calculate the crude measure of association (including 95%
    confidence intervals) between your exposure and outcome. Interpret
    this association. How did you arrive at your chosen reference group?

```{r}
fit <- glm(vycurrentasthma_dev ~ oy_rsv_infected_dev,
           family = binomial(link = "logit"),
           data = df)
summary(fit)
```

For a change from non-RSV infection during the first year of life to RSV
infection during the first year of life, the logit of subsequent child
asthma inception decreased by
`r round(summary(fit)[["coefficients"]][1,1], 3)`. In other words, for a
change from non-RSV infection during the first year of life to RSV
infection during the first year of life, the odds of subsequent child
asthma inception decreased by a factor of
`r round(exp(summary(fit)[["coefficients"]][1,1]), 3)`.

13. Table 3. Identify one variable that could be an effect modifier of
    the association between your exposure and outcome. Present stratum
    measures of association (including 95% confidence intervals),
    stratified by the potential effect measure modifier. Include
    frequencies. Calculate the Breslow Day test of homogeneity (Table
    3a). In addition, present the findings using a single referent group
    using the doubly unexposed as the referent group (Table 3b).
    Interpret the measures of association and comment on the potential
    for effect modification.

```{r}
df <- df %>% 
  mutate(any_family_asthma = if_else(MAT_ASTHMA_EVER == "Maternal asthma" | PAT_ASTHMA_EVER == "Paternal asthma", 1, 0))

dmm_tab_data <- tibble(
  RSV_infection_first_life = rep(c("YES", "YES", "NO", "NO"), 2),
  child_asthma_development = rep(c("YES", "NO"), 4),
  family_history_asthma = c(rep("NO", 4), rep("YES", 4)),
  count = c(count(df %>% filter(any_family_asthma==0 & oy_rsv_infected_dev=="PCR or Serology positive" & vycurrentasthma_dev=="Six-year current asthma")) %>% unlist(),
            count(df %>% filter(any_family_asthma==0 & oy_rsv_infected_dev=="PCR or Serology positive" & vycurrentasthma_dev=="Not")) %>% unlist(),
            count(df %>% filter(any_family_asthma==0 & oy_rsv_infected_dev=="Not" & vycurrentasthma_dev=="Six-year current asthma")) %>% unlist(),
            count(df %>% filter(any_family_asthma==0 & oy_rsv_infected_dev=="Not" & vycurrentasthma_dev=="Not")) %>% unlist(),
            count(df %>% filter(any_family_asthma==1 & oy_rsv_infected_dev=="PCR or Serology positive" & vycurrentasthma_dev=="Six-year current asthma")) %>% unlist(),
            count(df %>% filter(any_family_asthma==1 & oy_rsv_infected_dev=="PCR or Serology positive" & vycurrentasthma_dev=="Not")) %>% unlist(),
            count(df %>% filter(any_family_asthma==1 & oy_rsv_infected_dev=="Not" & vycurrentasthma_dev=="Six-year current asthma")) %>% unlist(),
            count(df %>% filter(any_family_asthma==1 & oy_rsv_infected_dev=="Not" & vycurrentasthma_dev=="Not")) %>% unlist()
                  )
)

tab <- xtabs(count ~ RSV_infection_first_life + child_asthma_development + family_history_asthma, data = dmm_tab_data)
tab

# without family history of asthma
oddsratio(x = tab[c(1,3,2,4)],
          y = NULL,
          method = "wald",
          conf.level = 0.95,
          rev = "neither")

# with family history of asthma
oddsratio(x = tab[c(5,7,6,8)],
          y = NULL,
          method = "wald",
          conf.level = 0.95,
          rev = "neither")
# Model based
fit_emm <- glm(vycurrentasthma_dev ~ oy_rsv_infected_dev*any_family_asthma,
           family = binomial(link = "logit"),
           data = df)
summary(fit_emm)
epi.interaction(fit_emm,
                coef = c(2,3,4),
                param = "product",
                conf.level = 0.95)

# Breslow Day Test
fit_bdt <- glm(vycurrentasthma_dev ~ oy_rsv_infected_dev+any_family_asthma,
           family = binomial(link = "logit"),
           data = df)
BreslowDayTest(tab, OR = exp(summary(fit_bdt)[["coefficients"]][1,1]))
```

We selected family history of asthma because it is a proxy of genetic
influence which was expected as an effect modifier. Our logistic
regression model could not find any effect modifications based on both
additive and multiplicative interaction. On the other hand, we performed
the Breslow Day test of homogeneity using the odds ratio adjusted for
family history of asthma, and it found a significant result. It means
there might be a effect modification either additive or multiplicative
scale. In total, we determined a family history of asthma may not be an
effect modifier because based on the two-by-two contingency table, there
may not be a large difference of child asthma inception between children
with family history of asthma and those without it.

14. Table 4. For at least 5 of your confounders, identify whether the
    confounder is associated with outcome among the unexposed. Hint:
    create a table with crude OR (and 95% CI) for the association
    between that confounder and your outcome among the unexposed
    (include frequencies or means as necessary -- similar to table
    above)

We selected the following confounders: infant sex (male vs. female),
child race/ethnicity (White-non-Hispanic vs. all other ethnic and racial
groups), mode of delivery (vaginal vs. cesarean), maternal marital
status (married vs. single), maternal education, maternal or paternal
asthma status (absent vs. present), and insurance status (Medicaid vs.
all other insurance), breast feeding status, presence of sibling and day
care attendance in the first year of life.

```{r}
# select only binary variables
confounders <- c("sex",
                #"ethnicity",
                "DELIVERYMODE",
                "MAT_MARITAL_STATUS",
                # "MAT_EDUCYEARS",
                "any_family_asthma",
                #"INSURANCE_CHILD",
                "EVERBREASTFED",
                "DAYCARE_OY")

for (confounder in confounders){
  df_unexp <- df %>% filter(oy_rsv_infected_dev == "Not")
  print(confounder)
  confound_tab <- table(as.integer(unlist(df_unexp[,confounder])), df_unexp$vycurrentasthma_dev)
  print(oddsratio(confound_tab))
}

confounders <- c(#"sex",
                "ethnicity",
                #"DELIVERYMODE",
                #"MAT_MARITAL_STATUS",
                #"MAT_EDUCYEARS",
                #"any_family_asthma",
                "INSURANCE_CHILD")
                #"EVERBREASTFED",
                #"DAYCARE_OY")

for (confounder in confounders){
  df_unexp <- df %>% filter(oy_rsv_infected_dev == "Not")
  print(confounder)
  confound_tab <- table(as.integer(unlist(df_unexp[,confounder])), df_unexp$vycurrentasthma_dev)
  print(confound_tab)
  print(fisher.test(confound_tab))
}

df_unexp <- df %>% filter(oy_rsv_infected_dev == "Not")
t.test(MAT_EDUCYEARS ~ vycurrentasthma_dev, data = df_unexp)

```

In our analyses, only sex and family history of asthma had a significant
association with child asthma inception. For a change from male to
female, the odds of subsequent child asthma inception increased. For a
change from non-family history of asthma to family history of asthma,
the odds of subsequent child asthma inception increased.

15. Table 5. For at least 5 of your confounders, identify whether the
    confounder is associated with the exposure among the general
    population. Hint: create a table of the crude OR (and 95% CI) for
    the association between that confounder and your exposure among the
    total population (for cohort or cross-sectional studies) or among
    the controls (for case-control studies).

```{r}
confounders <- c("sex",
                #"ethnicity",
                "DELIVERYMODE",
                "MAT_MARITAL_STATUS",
                # "MAT_EDUCYEARS",
                "any_family_asthma",
                #"INSURANCE_CHILD",
                "EVERBREASTFED",
                "DAYCARE_OY")

for (confounder in confounders){
  print(confounder)
  confound_tab <- table(as.integer(unlist(df[,confounder])), df$oy_rsv_infected_dev)
  print(oddsratio(confound_tab))
}

confounders <- c(#"sex",
                "ethnicity",
                #"DELIVERYMODE",
                #"MAT_MARITAL_STATUS",
                #"MAT_EDUCYEARS",
                #"any_family_asthma",
                "INSURANCE_CHILD")
                #"EVERBREASTFED",
                #"DAYCARE_OY")

for (confounder in confounders){
  print(confounder)
  confound_tab <- table(as.integer(unlist(df[,confounder])), df$oy_rsv_infected_dev)
  print(confound_tab)
  print(fisher.test(confound_tab))
  print(fisher.multcomp(confound_tab))
  
}

t.test(MAT_EDUCYEARS ~ oy_rsv_infected_dev, data = df)
```

Delivery mode, day-care use, ethnicity and insurance had a significant
association with RSV infection during the first year of life. For a
change from vaginal to C-section, the odds of subsequent child asthma
inception increased. For a change from non-day-care use to day-care use,
the odds of subsequent child asthma inception increased. Regarding
ethnicity and insurance, they are multiple-comparions and our pairwise
Fisher tests showed only a change from non-hispanic white to
non-hispanic black decreased the odds of subsequent child asthma.

16. Table 6. Depending on the results of questions #14 and #15, decide
    which confounders you should adjust for in the multivariable
    analysis (Hint: confounders should be associated with the outcome
    among the unexposed and associated with the exposure among the
    general population). Present your results in a table and interpret
    the measure of association.

Depending on the questions #14 and #15, none of them might not be
controlled in our analysis. However, we should decide the covariates
theoretically or based on previous literature. Otherwise, we can miss
important confounders in the analysis.

17. Table 7. Using directed acyclic graphs that you constructed as a
    part of your exercises, construct a final DAG for your project.
    Using this DAG, determine the set of confounders that you would
    include in your multivariable model. For effect measure
    modification, feel free to rely on your empiric assessment. Present
    these results in a table and interpret the measure of association.
    Are the variables you chose for confounding in your multivariable
    model based on DAG different than empiric methods you used in the
    questions above? Are the effect estimates between your exposure
    outcome relationship different if you based your variable selection
    based on DAGs vs. empiric method?

We described DAG in the question #5, and address the issue in the
question #16. In our main analysis, we selected clinically important
confounders. Regarding effect modifiers, we cannot access them at this
time, but we will include them in our final analysis.

```{r}
fit_adj <- glm(vycurrentasthma_dev ~ oy_rsv_infected_dev + sex + ethnicity + 
                 DELIVERYMODE + MAT_MARITAL_STATUS + MAT_EDUCYEARS +
                 any_family_asthma + INSURANCE_CHILD + EVERBREASTFED + DAYCARE_OY,
               family = binomial(link = "logit"),
               data = df)
summary(fit_adj)
```

18. In one or two paragraphs, briefly discuss whether your dataset
    provides adequate information to answer your research question. Show
    evidence in terms of a) number of participants with analyzable data
    for the exposure, outcome, and confounders, b) quality of exposure
    and outcome assessment, and c) how your measurements conform to the
    generally agreed upon standards for your exposure or outcome

The INSPIRE cohort included about 2,000 participants prospectively, and
had only small number of missing data about baseline characteristics.
Regarding exposure variables, we categorized them to avoid missing data
based on theoretically valid approach. Regarding outcome variables, we
had about 30% of missing data in the five-year current asthma. However,
as shown below, there were not large difference of participants'
characteristics between completed and loss-to-follow-up participants. In
addition, the INSPIRE cohort had multiple short-term outcomes such as
recurrent wheeze, thus we can perform some sensitivity analyses to
evaluate the validity of our main analysis. The participants' data were
collected by skilled-staffs, and the quality was adequate and met the
general standard. Regarding participant's characteristics, we combined
the information of electrical medical record, administrative data, and
questionnaires. Regarding the exposure variables, we collected RSV
serology at 1-year follow-up in addition to RSV PCR at illness visits.
The measurement error of these variables could be small. Regarding the
outcomes variables, there may be inter- and intra-observer variablity
[@islam]. However, we selected multiple valid outcome scales based on
the information both from parents and physicians.

```{r}
df <- df %>% 
  mutate(vycurrentasthma_dev_mis = if_else(is.na(vycurrentasthma_dev), 1, 0))
         
table2 <- CreateTableOne(vars = vars,
                         data = df,
                         includeNA = FALSE,
                         factorVars = factorVars,
                         strata = "vycurrentasthma_dev_mis")
table2 %>% 
  print() %>% 
  write.csv(here("output/table2.csv"))
```

19. In one or two paragraphs, discuss whether or not your study design
    is adequate for testing your hypothesis. If not what are the
    limitations (Consider the following factors: study design, sample
    size, sampling methods, statistical analysis methods, data
    collection techniques, selection of reference population and any
    control populations, if appropriate)? What could be done better in a
    future study? (Note: please suggest something other than a
    randomized clinical trial).
20. In one or two paragraphs, discuss the specific strengths in you
    study (Consider the following factors: uniqueness of your database,
    study design, sample size, sampling methods, statistical methods,
    data collection techniques, selection of reference population and
    any control populations, if appropriate)?

The INSPIRE cohort would be adequate for drawing a conclusion on the
research question "is RSV infection during the first year of life
associated with the risk of subsequent child asthma inception". To date,
it is unclear whether age at first RSV infection confers variable risk
for subsequent child asthma inception. This would be important if
delaying the first infection were a method of preventing asthma
development. For this topic, our systematic review revealed the age of
after 3-6 months of age might confer the highest risk, but previous
observational studies have a high risk of bias such as measurement error
of RSV infection and asthma, as well as many unadjusted confounding
factors. In particular, shared genetic predisposition to both severe RSV
infection and child asthma inception is likely a major confounding
factor when defining the exposure of interest as a clinical phenotype of
RSV infection rather than an exposure, only severe infection
[@brunwasser2020a]. The unique design of INSPIRE cohort was to represent
the complete spectrum (mild to severe) of RSV infection, instead of only
severe RSV infection, to overcome the confounding effect of genetic
predisposition to both severe RSV infection and child asthma inception.
In addition, we precisely collected all potential confounders. INSPIRE
study would be adequate to address our research question. Our study
would overcome the limitations in previous studies.

21. Make a final determination on whether or not you think your study is
    feasible. Explain your answer and suggest if there is a need to
    modify your research question or obtain an alternative dataset.

Our study is feasible and suitable for identifying the effect RSV
infection during the first year of life.

**Reference**

[@binns2022; @brunwasser2020; @brunwasser2020a; @coutts2020;
@coutts2020a; @islam; @larkin2015; @piedimonte2014; @piedimonte2014a;
@shi2020]
