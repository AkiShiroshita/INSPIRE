---
title: "Assignment 2"
author: "Akihiro Shiroshita, Tebeb Gebretsadik, Tina V. Hartert"
description: Vanderbilt University
fontfamily: accanthis 
fontsize: 11pt       
linestretch: 1 
output: word_document
editor_options: 
  markdown: 
    wrap: 72
bibliography: references.bib
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
	echo = TRUE,
	message = FALSE,
	warning = FALSE,
	fig.pos="t",
	fig.height=4,
	dpi = 350,
	out.extra=""
)

packages = c("devtools",
             "usethis",
             "here",
             "readr",
             "readxl",
             "expss",
             "tidyverse",
             "tidylog",
             "lubridate",
             "ggplot2",
             "ggplotgui",
             "ggthemes",
             "arsenal",
             "stats",
             "epitools",
             "DescTools",
             "epiR",
             "RVAideMemoire",
             "tableone",
             "flextable",
             "huxtable",
             "naniar",
             "VIM",
             "margins",
             "modmarg",
             "broom",
             "aod")

package.check <- lapply(packages, FUN = function(x){
  if (!require(x, character.only = TRUE)){
    install.packages(x, dependencies = TRUE)
    library(x, character.only = TRUE)
  }
})
```

1.  Restate your research question in the form of a testable hypothesis

**Research question**

What is the age at the first respiratory syncytial virus (RSV) infection
strongly associated with the risk of subsequent childhood asthma
inception among term and healthy infants? In this assignment, more
specifically, is RSV infection during the first year of life associated
with the risk of subsequent childhood asthma inception among term and
healthy infants?

2.  In one or two paragraphs, state the study design for this specific
    project (this may be different from the design for the parent
    study). Be sure to describe the study population in terms of
    inclusion and exclusion criteria. Additionally, include any
    information about how participants were sampled/recruited, if
    applicable.

**Study design**

Our study was based on the prospective population-based birth cohort
study recruited from the middle Tennessee region of the southeastern
United States, the Infant Susceptibility to Pulmonary Infections and
Asthma Following RSV Exposure (INSPIRE) study. The INSPIRE cohort
consists of nearly 2,000 term and healthy infants followed from early
infancy through 6 years of age. RSV was defined through biweekly
surveillance during the first year of life, and asthma was defined at
age 5-6 years. Detailed methods have been previously published
[@larkin2015]. The current study was approved by the Institutional
Review Board at Vanderbilt University Medical Center. Written informed
consent was provided by a parent or legal guardian of an infant
participant. The INSPIRE study was funded by a National Institute of
Allergy and Infectious Diseases (NIAID) Asthma and Allergic Diseases
Cooperative Research Center (AADCRC) grant.

**Study participants**

INSPIRE study participants were recruited from regional pediatric
practices. Inclusion criteria were singleton birth; an infant who was
born between June and December of 2012 and 2013; term birth ≥37 weeks;
birth weight ≥2250 g (5 lbs); no intention of relocating from area
within 5 years. The restriction to birth months of June through December
was so that each infant would be on average 6 months of age or less
entering their first RSV season [@piedimonte2014]. The unique design of
this population-based cohort was to represent the complete spectrum
(mild to severe) of RSV infection, instead of only severe RSV infection,
to overcome the confounding effect of genetic predisposition to both
severe RSV infection and child asthma inception [@brunwasser2020].
Exclusion criteria were mechanical ventilation before enrolment, receipt
of RSV immunoprophylaxis and significant medical co-morbidities.

**Comments**\
At this phase, I cannot access the information about the recruitment
(e.g. how many infants met the inclusion criteria but declined to
participate, or were excluded because of the exclusion criteria). The
patient selection flows are described below.

3.  In one paragraph, describe the exposure assessment and how it will
    be analyzed. For the purposes of this assignment, you should use
    either a dichotomous or categorical exposure variable. If your
    original exposure variable was continuous and you categorized it,
    what cut-points did you use to categorize your variables and why did
    you choose those cut points?

**Exposure**

First RSV infection was determined during each infant's first year of
life by biweekly active and passive surveillance using RSV RT-PCR to
identify RSV infections, and serum RSV antibody testing at one year. The
age at the first RSV infection was determined by the RSV PCR positive
age at specimen collection. For complete case analysis, we restricted to
RSV-infected participants who were detected by nasal PCR to define
infant age of infection in the first year of life. Children who were RSV
PCR negative and RSV serology positive at age 1-year were considered as
RSV infected during the first year of life while those who were RSV PCR
negative and RSV serology negative at age 1-year as RSV infected after
age one. This assumption is reasonable because most children acquire
first RSV infection in the first 2 years of life [@piedimonte2014a]. For
imputed models, we performed a single imputation of age of first RSV
infection for infants who were defined by serology only by leveraging
the infant's date of birth and the known RSV dates of circulation and
rates during the infant's first year of life.

**Comments**

We performed multiple statistical analyses described below: complete
case analysis as well as imputed models using either categorical or
continuous age at first RSV infection. The cut-off of categorical age
was 6 months and 1-year because our systematic review revealed the
association between RSV infection and childhood asthma inception might
be stronger after 6 months of age compared to before 3-6 months. We
collected RSV serology at 1-year follow-up visit which supplemented the
results of RSV PCR during the first year of life, thus we imputed the
age at the first RSV infection for children with only RSV serology
positive. A single imputation incorporating the RSV seasonality was
conducted. Because of the sample size deficiency, we could not
categorize the age further (e.g. \< 3months, 3-6 months, \< 6 months).

**Important**

Just for the simplicity, we used a dichotomized exposure variable (first
RSV infection during the first year of life, or not) without imputation.
This analysis is for this assignment, and we did not use for our main
analysis. In the main text, the results of dichotomized exposure
variable are sumarized while in the appendix, the results of our main
analyes are summarized.

Figure: Patient selection flow for categorical age models

Figure: Patient selection flow for continuous age models

4.  In one paragraph, describe the outcome assessment and how it will be
    analyzed. For the purposes of this assignment, you should use a
    dichotomous outcome variable. If the outcome is continuous or
    categorical, state how you decided to dichotomize it into the groups
    you chose.

**Outcome**

The primary outcome was current asthma at 5 years which was defined by
both 1) physician diagnosis by 5 years and 2) parental report of
symptoms, systemic steroid use, or healthcare utilization for asthma in
prior 12 months. The secondary outcomes were annual recurrent wheeze at
2,3, and 4 years which were defined as parental report of ≥2 wheezing
episodes since the child's last birthday.

**Statistical analysis**\
*Descriptive analysis*

Enrollment participants' characteristics were described by RSV status
for RSV-infected infants and non-RSV infected infants as frequencies and
proportions for categorical variables and as means with standard
deviations for continuous variables.

*Complete case analysis*

We used univariable and multivariable logistic regression models using
children without missing data. For a categorical age model, we included
children with positive PCR and/or positive serology as well as those
with negative PCR and serology. For a continuous age model, we included
children with positive PCR and/or positive serology as well as those
with negative PCR and serology

*Imputed model*

Same as the complete case analyses, we used univariable and
multivariable logistic regression models using children with RSV PCR
positive and/or serology positive at 1-year follow-up vitis. The date at
first RSV infection for children with only RSV serology positive was
randomly draw from the RSV season from October 1 to April 1. Then, we
calculated the age of first RSV infection by subtracting it from each
child's date of birth.

*Software*

For statistical analyses, we used R software version 4.2.1 (R foundation
for Statistical Computing, Vienna, Austria)

5.  Based on your literature review and any other substantive knowledge
    you have of the subject, list the potential confounders and effect
    modifiers you think should be included in the analysis of your
    exposure and outcome. Indicate whether all these confounders and
    modifiers are available in your dataset.

**Confounders**

Based on previous literature, we selected sex (male vs. female) as a
clinical relevant confouder [@shi2020; @coutts2020a]. In addition, the
following variables might be a potential confounders or risk factors for
RSV infection or childhood asthma: child race/ethnicity
(White-non-Hispanic vs. all other ethnic and racial groups), mode of
delivery (vaginal vs. cesarean), maternal marital status (married vs.
single), maternal education, maternal asthma status (absent vs.
present), and insurance status (Medicaid vs. all other insurance),
breast feeding status, presence of sibling, and day care attendance in
the first year of life. In our study, because of the limited sample
size, only sex was adjusted in the models.

**Effect modifier**

Infant sex, breastfeeding, family history of asthma, viral co-infection
and genetic influences such as 17q1221 SNPs are expected as effect
modifiers [@binns2022; @chowdhury2021; @lim2010; @liptzin2015; @liu2018;
@martel2009].

**Comments**

Regarding potential confounders, our cohort study included all necessary
information, but the variables other than sex, we determined the
clinical importance as confounders may be small and they could be
considered as risk factors. Thus, considering the limited sample size,
sex was incorporated as a covariate in the multivariable models.

Regarding effect modifications, our cohort study collected the
information about viral co-infection and genetic influences, for this
phase of analysis, we evaluated the effect modification of infant sex,
family history of asthma and breastfeeding because we cannot easily
access viral co-infection and genetic influences.

6.  Label all the variables in your dataset.
7.  For all categorical or dichotomous variables, add value labels for
    all groups.

```{r}
df <- read_csv(here("output/analysis_data.csv"))

df <- df %>% 
  mutate(rsv_pcr_age = trunc(time_length(interval(INFANTDOB, rftodaydate), "day"))) %>%
  dplyr::select(cfsubjid, STUDYENROLLDATE, INFANTDOB,
         # baseline characteristics (numeric)
         GESTAGEWK, BIRTHWEIGHT_GRAM, BREASTFEDDUR, OTHERLIVSIBS_BIO,
         OTHERLIVSIBS_HAL, HOUSEHOLDSIZE, MAT_EDUCYEARS,
         # baseline characteristics (categorical)
         sex, ethnicity, MATSMOKE_PREG, DAYCARE_OY, MAT_ASTHMA_EVER,
         EVERBREASTFED, DELIVERYMODE,
         MAT_MARITAL_STATUS, INSURANCE_CHILD, residence6mo,
         # exposure
         #rftodaydate, # PCR sampling date
         anyrsv_dev, # RSV positive
         rsv_pcr_age, # age at positive PCR sampling date
         #BSS2_dev, # severity
         oy_rsv_infected_dev, # PCR or serology positive
         rsv_exposed_dev, # serology
         # outcome
         oy_rec_whz_dev, ty_rec_whz_dev, ry_rec_whz_dev,
         fy_rec_whz_dev, vy_rec_whz_dev, xy_rec_whz_dev,
         fycurrentasthma_dev, vycurrentasthma_dev
         ) %>% 
  apply_labels(GESTAGEWK = "Gestational age of infant at birth",
               BIRTHWEIGHT_GRAM = "Birth weight",
               BREASTFEDDUR = "Duration of breastfeeding (weeks)",
               OTHERLIVSIBS_BIO = "Number of biological siblings",
               OTHERLIVSIBS_HAL = "Number of half siblings",
               HOUSEHOLDSIZE = "Total number of people",
               rsv_pcr_age = "Age at positive RSV PCR sampling date") %>% 
  mutate(# baseline characteristics
         enroll_age = trunc(time_length(interval(INFANTDOB, STUDYENROLLDATE), "month")),
         sex = factor(sex, levels = c(0,1), labels = c("Female", "Male")),
         ethnicity = factor(ethnicity, levels = c(0,1,2), labels = c("Non-hispanic White", "Non-hispanic balck", "Hispanic and other")),
         MATSMOKE_PREG = factor(MATSMOKE_PREG, levels = c(0,1), labels = c("Not", "Maternal smoking during pregnancy")),
         DAYCARE_OY = factor(DAYCARE_OY, levels = c(0,1), labels = c("Not", "Daycase use furing the first year")),
         other_sib_cat = case_when(OTHERLIVSIBS_BIO + OTHERLIVSIBS_HAL == 0 ~ 0,
                                   OTHERLIVSIBS_BIO + OTHERLIVSIBS_HAL == 1 ~ 1,
                                   1 < OTHERLIVSIBS_BIO + OTHERLIVSIBS_HAL ~ 2),
         other_sib_cat = factor(other_sib_cat, levels = c(0,1,2), labels = c("None", "One sibling", "2 or more siblings")),
         MAT_ASTHMA_EVER = factor(MAT_ASTHMA_EVER, levels = c(0,1), labels = c("Not", "Maternal asthma")),
         EVERBREASTFED = factor(EVERBREASTFED, levels = c(0,1), labels = c("Not", "Breast feeding")),
         DELIVERYMODE = factor(DELIVERYMODE, levels = c(0,1), labels = c("Vaginal", "C-section")),
         MAT_EDUC_cat = case_when(MAT_EDUCYEARS < 9 ~ 0,
                                  9 <= MAT_EDUCYEARS & MAT_EDUCYEARS <= 12 ~ 1,
                                  12 < MAT_EDUCYEARS ~ 2),
         MAT_EDUC_cat = factor(MAT_EDUC_cat, levels = c(0,1,2), labels = c("less than HS/GED", "HS/GED", "more than HS/GED")),
         MAT_MARITAL_STATUS = factor(MAT_MARITAL_STATUS, levels = c(1,2,3), labels = c("Single", "Married", "Divorces/Separated")),
         INSURANCE_CHILD = factor(INSURANCE_CHILD, levels = c(1,2,3,4,5), labels = c("Medicaid", "Private", "Self-Pay", "None", "Other")),
         residence6mo = factor(residence6mo, levels = c(0,1), labels = c("Rural", "Urban")),
         # exposure
         anyrsv_dev = factor(anyrsv_dev, levels = c(0,1), labels = c("Not","RSV PCR positive")),
         oy_rsv_infected_dev = factor(oy_rsv_infected_dev, levels = c(0,1), labels = c("Not", "PCR or Serology positive")),
         rsv_exposed_dev = factor(rsv_exposed_dev, levels = c(0,1), labels = c("Not", "Serology positive")),
         # outcome
         oy_rec_whz_dev = factor(oy_rec_whz_dev, levels = c(0,1), labels = c("Not", "Recurrent wheeze during the first year")),
         ty_rec_whz_dev = factor(ty_rec_whz_dev, levels = c(0,1), labels = c("Not", "Recurrent wheeze during the second year")),
         ry_rec_whz_dev = factor(ry_rec_whz_dev, levels = c(0,1), labels = c("Not", "Recurrent wheeze during the third year")),
         fy_rec_whz_dev = factor(fy_rec_whz_dev, levels = c(0,1), labels = c("Not", "Recurrent wheeze during the fourth year")),
         vy_rec_whz_dev = factor(vy_rec_whz_dev, levels = c(0,1), labels = c("Not", "Recurrent wheeze during the fifth year")),
         xy_rec_whz_dev = factor(xy_rec_whz_dev, levels = c(0,1), labels = c("Not", "Recurrent wheeze during the sixth year")),
         fycurrentasthma_dev = factor(fycurrentasthma_dev, levels = c(0,1), labels = c("Not", "Five-year current asthma")),
         vycurrentasthma_dev = factor(vycurrentasthma_dev, levels = c(0,1), labels = c("Not", "Six-year current asthma")),)
```

8.  Is there missing data in your dataset? If so, explain how missing
    values are coded and how they will be handled in the analysis.
    Summarize interesting missing data patterns.

```{r}
# overall missing

pct_miss(df)

# baseline characteristics

gg_miss_var(df %>% select(# baseline characteristics (numeric)
          enroll_age, GESTAGEWK, BIRTHWEIGHT_GRAM, BREASTFEDDUR, OTHERLIVSIBS_BIO,
          OTHERLIVSIBS_HAL, HOUSEHOLDSIZE,
          # baseline characteristics (categorical)
          sex, ethnicity, MATSMOKE_PREG, DAYCARE_OY, MAT_ASTHMA_EVER,
          EVERBREASTFED, DELIVERYMODE,
          MAT_EDUCYEARS, MAT_MARITAL_STATUS, INSURANCE_CHILD, residence6mo)) +
  labs(title = "Participants' baseline characteristics")

# exposure  

gg_miss_var(df %>% select(#rftodaydate, # PCR sampling date
         anyrsv_dev, # RSV positive
         rsv_pcr_age,
         #BSS2_dev, # severity
         oy_rsv_infected_dev, # PCR or serology positive
         rsv_exposed_dev, # serology,
         #oysmpbldrschdate,
         )) +
  labs(title = "Exposure status")

# outcome

gg_miss_var(df %>% select(
         oy_rec_whz_dev, ty_rec_whz_dev, ry_rec_whz_dev,
         fy_rec_whz_dev, vy_rec_whz_dev, xy_rec_whz_dev,
         fycurrentasthma_dev, vycurrentasthma_dev)) +
  labs(title = "Outcome status")

gg_miss_upset(df %>% select(
         oy_rec_whz_dev, ty_rec_whz_dev, ry_rec_whz_dev,
         fy_rec_whz_dev, vy_rec_whz_dev, xy_rec_whz_dev,
         fycurrentasthma_dev, vycurrentasthma_dev))

# summary

miss_tab <- miss_var_summary(df)
miss_tab
```

Generally, missing data were coded as "NA".

Regarding exposure variables,

-   anyrsv_dev: 1-PCR positive, NA-missing + negative

-   rsv_pcr_age: RSV PCR positive age at specimen collection

-   rsv_exposed_dev: 1-serology positive, 0-negative, NA-missing

-   oy_rsv_infected_dev: 1-PCR or serology positive, 0-negative,
    NA-missing

We used "rsv_pcr_age" as an exposure and categorized it into three
groups: \< 6 months, 6-12 months, and after 12 months.

Regarding the primary outcome of 5-year current asthma, 451 (23%) were
missed.

**Missing data**

INSPIRE cohort had only small percent of missing data in participants'
baseline characteristics. Regarding exposures, for infants with RSV PCR
positive we used the age at specimen collection. For infants or children
for which age of RSV infection is not ascertained but known to be
serology positive or negative, we assigned RSV infected during the first
year of life and RSV infected after age one, respectively. For imputed
models, we assigned the imputed value which was randomly draw between
(date of birth or October 1) and (date of RSV serology positive at
1-year visit or April 1). Regarding outcomes, about 300 children missed
all the outcome information after the 2-year visit (monotone missing).
That is when the variable was missing, then all other variables examined
later were also missing. Regarding the primary outcome of 5-year current
asthma, 588 (30%) were missed. There were 451 (23%) missing data in
4-year current asthma, and 481 (25%) in recurrent wheeze at 4-year
visits. As a sensitivity analysis, we used a different outcome
definition.

**Comments**

R code of single imputation is described in the appendix.

9.  Table 0. Create a list of all the variables in your dataset,
    including exposure, outcome, covariates, confounders and effect
    modifiers.

A total of 1946 term healthy infants were followed through 6 years of
age. The mean age of enrolment was 1.6 months. Among them, 1220 (63%) of
children had at least one acute illness visit, and 944 (54%) infants
were infected with RSV during their first year of life. Among those RSV
infected, 361 (38%) infants were detected by nasal PCR at acute illness
visits and 582 (62%) infants were detected only by RSV serology at
1-year. The mean age of first RSV infection was about 4 months (standard
deviation of 2 months). At the five-year follow-up, 286 (19%) had
asthma.

**Comments**

Because the table became so busy, we summarized the results into
different tables. Percent missing is summarized in the above question.
The variable name, variable label, and variable type (continuous,
categorical, dichotomous) are summarized in the appendix.

```{r}
vars <- df %>% 
  select(-cfsubjid, -STUDYENROLLDATE, -INFANTDOB) %>%
  colnames()
factorVars <- df %>% 
  select(-cfsubjid, -STUDYENROLLDATE, -INFANTDOB) %>%
  select(where(is.factor)) %>% 
  colnames()

table0 <- CreateTableOne(vars = vars,
                         data = df,
                         includeNA = FALSE,
                         factorVars = factorVars)
table0 %>% 
  print(test = FALSE, nonnormal = c("GESTAGEWK", "BIRTHWEIGHT_GRAM", "BREASTFEDDUR", "OTHERLIVSIBS_BIO", "OTHERLIVSIBS_HAL", "HOUSEHOLDSIZE", "MAT_EDUCYEARS")) %>% 
  write.csv(here("output/table0.csv"))
```

```{r echo=TRUE, message=FALSE, warning=FALSE}
dvars <- df %>% 
  dplyr::select(enroll_age, sex, ethnicity, MAT_EDUC_cat, MAT_MARITAL_STATUS, MAT_ASTHMA_EVER, INSURANCE_CHILD, GESTAGEWK,
         BIRTHWEIGHT_GRAM, DELIVERYMODE, EVERBREASTFED, DAYCARE_OY, other_sib_cat, oy_rsv_infected_dev,
         vycurrentasthma_dev) %>%
  colnames()
dfactorVars <- df %>% 
  dplyr::select(enroll_age, sex, ethnicity, MAT_EDUC_cat, MAT_MARITAL_STATUS, MAT_ASTHMA_EVER, INSURANCE_CHILD, GESTAGEWK,
         BIRTHWEIGHT_GRAM, DELIVERYMODE, EVERBREASTFED, DAYCARE_OY, other_sib_cat, oy_rsv_infected_dev,
         vycurrentasthma_dev) %>%
  dplyr::select(where(is.factor)) %>% 
  colnames()

dtable0 <- CreateTableOne(vars = dvars,
                         data = df,
                         includeNA = FALSE,
                         factorVars = factorVars)
dtable0 %>% 
  print(test = FALSE, contDigits = 1, catDigits = 1) %>% 
  as.data.frame() %>% 
  mutate("Variables" = c("Number of infants", "Age at enrollment (month)",
                    "Male sex", 
                    "Ethnicity", "\t Non-hispanic White", "\t Non-hispanic balck", "\t Hispanic and other",
                    "Maternal education", "\t Less than high school/general educational development",
                    "\t High school/general educational development",
                    "\t More than High school/general educational development",
                    "Maternal marital status", "Single",
                    "\t Married", "\t Divorces/Separated",
                    "Maternal history of asthma",
                    "Insurance of infant", "\t Medicaid", "\t Private", "\t Self-Pay", "\t None", "\t Other",
                    "Gestational age (weeks)", "Birth weight", 
                    "Birth by cesarean section", "Daycare use during the first year", "Ever any breastfeeding",
                    "Presence of biological siblings", "\t None", "\t One sibling", "\t Two or more Siblings",
                    "RSV infection detected by PCR or serology during the first year",
                    "Five-year current asthma")) %>% 
  dplyr::select(Variables, everything()) %>% 
  regulartable() %>% 
  theme_booktabs() %>% 
  autofit()
```

10. Create histograms for all continuous variables. Comment on outliers,
    skewed distributions (and whether/what transformation may be
    necessary)

```{r}
num_vars <- df %>% 
  select(GESTAGEWK, BIRTHWEIGHT_GRAM, BREASTFEDDUR,
         OTHERLIVSIBS_BIO, OTHERLIVSIBS_HAL, MAT_EDUCYEARS, rsv_pcr_age
         ) %>% 
  colnames()

for (var in num_vars) {
  data <- df[, var] %>% unlist()
  hist(data,
       main=paste('Histogram of', var),
       xlab = paste(var))
}

boxplot(df$rsv_pcr_age)
summary(df$rsv_pcr_age)
```

The distributions of Infant's birth weight and maternal education are
similar to a normal distribution. Regarding other variables, their
distributions are right-skewed. In the analysis, we did not use any
continuous covariates, thus transformation or categorization was not
necessary. The histogram of age at first RSV infection is similar to
normal distribution, and the number of infants infected RSV at extremely
early or late age was small. However, the age effect for childhood
asthma inception would be non-linear. Thus, in the analysis, we
categorized the age into three groups (\< 6 months, 6-12 months, \< 12
months) or used a restricted cubic spline function with 5 knots for
continuous age.

11. Table 1. Create a table with categories of your main exposure
    variable as the columns. If your study design is cohort or
    cross-sectional include all participants in your study, otherwise
    use only controls if your study is a case-control study. Compute
    descriptive statistics (frequencies and proportion for categorical
    variables and mean ± SD for continuous variables) for all potential
    confounders by categories of your main exposure.

*Comments*\
We created a summary table stratified by the first RSV infection during
the first year of life.

```{r echo=FALSE, message=FALSE, warning=FALSE}
table1 <- CreateTableOne(vars = vars,
                         data = df %>% drop_na(oy_rsv_infected_dev),
                         includeNA = FALSE,
                         factorVars = factorVars,
                         strata = "oy_rsv_infected_dev")
table1 %>% 
  print(test = FALSE) %>% 
  write.csv(here("output/table1.csv"))
```

```{r echo=FALSE, message=FALSE, warning=FALSE}
dvars1 <- df %>% 
  select(enroll_age, sex, ethnicity, MAT_EDUC_cat, MAT_MARITAL_STATUS, INSURANCE_CHILD, GESTAGEWK,
         BIRTHWEIGHT_GRAM, DELIVERYMODE, EVERBREASTFED, DAYCARE_OY, other_sib_cat, 
         vy_rec_whz_dev) %>%
  colnames()
dfactorVars1 <- df %>% 
  select(enroll_age, sex, ethnicity, MAT_MARITAL_STATUS, INSURANCE_CHILD, GESTAGEWK,
         BIRTHWEIGHT_GRAM, DELIVERYMODE, EVERBREASTFED, DAYCARE_OY, other_sib_cat,
         vy_rec_whz_dev) %>%
  select(where(is.factor)) %>% 
  colnames()

dtable1 <- CreateTableOne(vars = dvars1,
                         data = df,
                         includeNA = FALSE,
                         factorVars = dfactorVars1,
                         strata = "oy_rsv_infected_dev")
dtable1 %>% 
  print(test = FALSE, contDigits = 1, catDigits = 1) %>% 
  as.data.frame() %>% 
  mutate("Variables" = c("Number of infants", "Age at enrollment (month)",
                    "Male sex", 
                    "Ethnicity", "\t Non-hispanic White", "\t Non-hispanic balck", "\t Hispanic and other",
                    "Maternal education", "\t Less than high school/general educational development",
                    "\t High school/general educational development",
                    "\t More than High school/general educational development",
                    "Maternal marital status", "\t Single",
                    "\t Married", "\t Divorces/Separated",
                    "Insurance of infant", "\t Medicaid", "\t Private", "\t Self-Pay", "\t None", "\t Other",
                    "Gestational age (weeks)", "Birth weight", 
                    "Birth by cesarean section", "Daycare use during the first year", "Ever any breastfeeding",
                    "Presence of biological siblings", "\t None", "\t One sibling", "\t Two or more Siblings",
                    "Five-year current asthma")) %>% 
  select(Variables, everything()) %>% 
  regulartable() %>% 
  theme_booktabs() %>% 
  autofit()
```

12. Table 2. Calculate the crude measure of association (including 95%
    confidence intervals) between your exposure and outcome. Interpret
    this association. How did you arrive at your chosen reference group?

*Comments*\
We summarize a complete case analysis result of a logistic regression
with categorized age exposure (first RSV infection \< 12 months or not)
here. The results of other complete case analyses and imputed models are
summarized in the appendix.

```{r}
fit <- glm(vycurrentasthma_dev ~ oy_rsv_infected_dev,
           family = binomial(link = "logit"),
           data = df)
dfit <- huxreg(fit,
               coefs = c("RSV infection during the first year of life" = "oy_rsv_infected_devPCR or Serology positive"),
                         statistics = c(N = "nobs"),
               tidy_args = list(exponentiate = TRUE),
               ci_level = 0.95,
               error_format = "[{conf.low}, {conf.high}]") %>% 
  set_caption("Crude odds ratio of RSV infection during the first year of life on asthma inception") %>% 
  as_flextable() 
dfit
```

For a change from non-RSV infection during the first year of life to RSV
infection during the first year of life, the logit of subsequent child
asthma inception decreased by
`r round(summary(fit)[["coefficients"]][1,1], 3)`. In other words, for a
change from non-RSV infection during the first year of life to RSV
infection during the first year of life, the odds of subsequent child
asthma inception decreased by a factor of
`r round(exp(summary(fit)[["coefficients"]][1,1]), 3)`.

13. Table 3. Identify one variable that could be an effect modifier of
    the association between your exposure and outcome. Present stratum
    measures of association (including 95% confidence intervals),
    stratified by the potential effect measure modifier. Include
    frequencies. Calculate the Breslow Day test of homogeneity (Table
    3a). In addition, present the findings using a single referent group
    using the doubly unexposed as the referent group (Table 3b).
    Interpret the measures of association and comment on the potential
    for effect modification.

-   Infant sex

```{r}
#df %>% filter(sex == "Male") %>% count()

dmm_tab_data <- tibble(
  RSV_infection_first_life = rep(c("YES", "YES", "NO", "NO"), 2),
  child_asthma_development = rep(c("YES", "NO"), 4),
  sex = c(rep("Male", 4), rep("Female", 4)),
  count = c(count(df %>% filter(sex=="Male" & oy_rsv_infected_dev=="PCR or Serology positive" & vycurrentasthma_dev=="Six-year current asthma")) %>% unlist(),
            count(df %>% filter(sex=="Male" & oy_rsv_infected_dev=="PCR or Serology positive" & vycurrentasthma_dev=="Not")) %>% unlist(),
            count(df %>% filter(sex=="Male" & oy_rsv_infected_dev=="Not" & vycurrentasthma_dev=="Six-year current asthma")) %>% unlist(),
            count(df %>% filter(sex=="Male" & oy_rsv_infected_dev=="Not" & vycurrentasthma_dev=="Not")) %>% unlist(),
            count(df %>% filter(sex=="Female" & oy_rsv_infected_dev=="PCR or Serology positive" & vycurrentasthma_dev=="Six-year current asthma")) %>% unlist(),
            count(df %>% filter(sex=="Female" & oy_rsv_infected_dev=="PCR or Serology positive" & vycurrentasthma_dev=="Not")) %>% unlist(),
            count(df %>% filter(sex=="Female" & oy_rsv_infected_dev=="Not" & vycurrentasthma_dev=="Six-year current asthma")) %>% unlist(),
            count(df %>% filter(sex=="Female" & oy_rsv_infected_dev=="Not" & vycurrentasthma_dev=="Not")) %>% unlist()
                  )
)

tab <- xtabs(count ~ RSV_infection_first_life + child_asthma_development + sex, data = dmm_tab_data)
tab

# Female
oddsratio(x = tab[c(1,3,2,4)],
          y = NULL,
          method = "wald",
          conf.level = 0.95,
          rev = "neither")

# Male
oddsratio(x = tab[c(5,7,6,8)],
          y = NULL,
          method = "wald",
          conf.level = 0.95,
          rev = "neither")
# Model based
fit_emm <- glm(vycurrentasthma_dev ~ oy_rsv_infected_dev*sex,
           family = binomial(link = "logit"),
           data = df)
dfit_emm <- huxreg(fit_emm,
               coefs = c("RSV infection during the first year of life" = "oy_rsv_infected_devPCR or Serology positive", "Male" = "sexMale", "Interaction term" = "oy_rsv_infected_devPCR or Serology positive:sexMale"),
                         statistics = c(N = "nobs"),
               tidy_args = list(exponentiate = TRUE),
               ci_level = 0.95,
               error_format = "[{conf.low}, {conf.high}]") %>% 
  set_caption("Effect modification of sex (odds ratio)") %>% 
  as_flextable() 
dfit_emm
epi.interaction(fit_emm,
                coef = c(2,3,4),
                param = "product",
                conf.level = 0.95)
wald.test(Sigma = vcov(fit_emm), b = coef(fit_emm), Terms = 4)

# second difference
ame <- margins(fit_emm,
               variables = "oy_rsv_infected_dev",
               at=list(oy_rsv_infected_dev=c("Not","PCR or Serology positive"),
                       sex=c("Female", "Male")))
ame_data <- as.data.frame(summary(ame))
vc <- vcov(ame)
diff <- ame_data$AME[2] - ame_data$AME[1]
se <- sqrt((vc[2,2] + vc[4,4]) - 2*vc[4,2])
zstat <- diff/se
pval <- 2*pnorm(-abs(zstat))
h <- as.data.frame(list(Estimate=diff, SE=se, Z_score=zstat, Two_sided_pvalue=pval))
h

# Breslow Day Test
fit_bdt <- glm(vycurrentasthma_dev ~ oy_rsv_infected_dev+sex,
           family = binomial(link = "logit"),
           data = df)
BreslowDayTest(tab, OR = exp(summary(fit_bdt)[["coefficients"]][1,1]))
```

-   Maternal family history of asthma

```{r}
df %>% filter(MAT_ASTHMA_EVER == "Maternal asthma") %>% count()

dmm_tab_data2 <- tibble(
  RSV_infection_first_life = rep(c("YES", "YES", "NO", "NO"), 2),
  child_asthma_development = rep(c("YES", "NO"), 4),
  family_history_asthma = c(rep("NO", 4), rep("YES", 4)),
  count = c(count(df %>% filter(MAT_ASTHMA_EVER=="Not" & oy_rsv_infected_dev=="PCR or Serology positive" & vycurrentasthma_dev=="Six-year current asthma")) %>% unlist(),
            count(df %>% filter(MAT_ASTHMA_EVER=="Not" & oy_rsv_infected_dev=="PCR or Serology positive" & vycurrentasthma_dev=="Not")) %>% unlist(),
            count(df %>% filter(MAT_ASTHMA_EVER=="Not" & oy_rsv_infected_dev=="Not" & vycurrentasthma_dev=="Six-year current asthma")) %>% unlist(),
            count(df %>% filter(MAT_ASTHMA_EVER=="Not" & oy_rsv_infected_dev=="Not" & vycurrentasthma_dev=="Not")) %>% unlist(),
            count(df %>% filter(MAT_ASTHMA_EVER=="Maternal asthma" & oy_rsv_infected_dev=="PCR or Serology positive" & vycurrentasthma_dev=="Six-year current asthma")) %>% unlist(),
            count(df %>% filter(MAT_ASTHMA_EVER=="Maternal asthma" & oy_rsv_infected_dev=="PCR or Serology positive" & vycurrentasthma_dev=="Not")) %>% unlist(),
            count(df %>% filter(MAT_ASTHMA_EVER=="Maternal asthma" & oy_rsv_infected_dev=="Not" & vycurrentasthma_dev=="Six-year current asthma")) %>% unlist(),
            count(df %>% filter(MAT_ASTHMA_EVER=="Maternal asthma" & oy_rsv_infected_dev=="Not" & vycurrentasthma_dev=="Not")) %>% unlist()
                  )
)

tab2 <- xtabs(count ~ RSV_infection_first_life + child_asthma_development + family_history_asthma, data = dmm_tab_data2)
tab2

# without family history of asthma
oddsratio(x = tab2[c(1,3,2,4)],
          y = NULL,
          method = "wald",
          conf.level = 0.95,
          rev = "neither")

# with family history of asthma
oddsratio(x = tab2[c(5,7,6,8)],
          y = NULL,
          method = "wald",
          conf.level = 0.95,
          rev = "neither")
# Model based
fit_emm2 <- glm(vycurrentasthma_dev ~ oy_rsv_infected_dev*MAT_ASTHMA_EVER,
           family = binomial(link = "logit"),
           data = df)
dfit_emm2 <- huxreg(fit_emm2,
               coefs = c("RSV infection during the first year of life" = "oy_rsv_infected_devPCR or Serology positive", "Maternal family history of asthma" = "MAT_ASTHMA_EVERMaternal asthma", "Interaction term" = "oy_rsv_infected_devPCR or Serology positive:MAT_ASTHMA_EVERMaternal asthma"),
                         statistics = c(N = "nobs"),
               tidy_args = list(exponentiate = TRUE),
               ci_level = 0.95,
               error_format = "[{conf.low}, {conf.high}]") %>% 
  set_caption("Effect modification of maternal history of asthma (odds ratio)") %>% 
  as_flextable() 
dfit_emm2
epi.interaction(fit_emm2,
                coef = c(2,3,4),
                param = "product",
                conf.level = 0.95)
wald.test(Sigma = vcov(fit_emm2), b = coef(fit_emm2), Terms = 4)
# second difference
ame2 <- margins(fit_emm2,
               variables = "oy_rsv_infected_dev",
               at=list(oy_rsv_infected_dev=c("Not","PCR or Serology positive"),
                       MAT_ASTHMA_EVER=c("Not","Maternal asthma")))
ame_data2 <- as.data.frame(summary(ame2))
vc2 <- vcov(ame2)
diff2 <- ame_data2$AME[2] - ame_data2$AME[1]
se2 <- sqrt((vc2[2,2] + vc2[4,4]) - 2*vc2[4,2])
zstat2 <- diff2/se2
pval2 <- 2*pnorm(-abs(zstat2))
h2 <- as.data.frame(list(Estimate=diff2, SE=se2, Z_score=zstat2, Two_sided_pvalue=pval2))
h2
# Breslow Day Test
fit_bdt2 <- glm(vycurrentasthma_dev ~ oy_rsv_infected_dev+MAT_ASTHMA_EVER,
           family = binomial(link = "logit"),
           data = df)
BreslowDayTest(tab2, OR = exp(summary(fit_bdt2)[["coefficients"]][1,1]))
```

-   Breastfeeding

```{r}
#df %>% filter(EVERBREASTFED == "Breast feeding") %>% count()

dmm_tab_data3 <- tibble(
  RSV_infection_first_life = rep(c("YES", "YES", "NO", "NO"), 2),
  child_asthma_development = rep(c("YES", "NO"), 4),
  breastfeeding = c(rep("NO", 4), rep("YES", 4)),
  count = c(count(df %>% filter(EVERBREASTFED=="Not" & oy_rsv_infected_dev=="PCR or Serology positive" & vycurrentasthma_dev=="Six-year current asthma")) %>% unlist(),
            count(df %>% filter(EVERBREASTFED=="Not" & oy_rsv_infected_dev=="PCR or Serology positive" & vycurrentasthma_dev=="Not")) %>% unlist(),
            count(df %>% filter(EVERBREASTFED=="Not" & oy_rsv_infected_dev=="Not" & vycurrentasthma_dev=="Six-year current asthma")) %>% unlist(),
            count(df %>% filter(EVERBREASTFED=="Not" & oy_rsv_infected_dev=="Not" & vycurrentasthma_dev=="Not")) %>% unlist(),
            count(df %>% filter(EVERBREASTFED=="Breast feeding" & oy_rsv_infected_dev=="PCR or Serology positive" & vycurrentasthma_dev=="Six-year current asthma")) %>% unlist(),
            count(df %>% filter(EVERBREASTFED=="Breast feeding" & oy_rsv_infected_dev=="PCR or Serology positive" & vycurrentasthma_dev=="Not")) %>% unlist(),
            count(df %>% filter(EVERBREASTFED=="Breast feeding" & oy_rsv_infected_dev=="Not" & vycurrentasthma_dev=="Six-year current asthma")) %>% unlist(),
            count(df %>% filter(EVERBREASTFED=="Breast feeding" & oy_rsv_infected_dev=="Not" & vycurrentasthma_dev=="Not")) %>% unlist()
                  )
)

tab3 <- xtabs(count ~ RSV_infection_first_life + child_asthma_development + breastfeeding, data = dmm_tab_data3)
tab3

# without breastfeeing
oddsratio(x = tab3[c(5,7,6,8)],
          y = NULL,
          method = "wald",
          conf.level = 0.95,
          rev = "neither")

# with breastfeeding
oddsratio(x = tab3[c(1,3,2,4)],
          y = NULL,
          method = "wald",
          conf.level = 0.95,
          rev = "neither")
# Model based
fit_emm3 <- glm(vycurrentasthma_dev ~ oy_rsv_infected_dev*EVERBREASTFED,
           family = binomial(link = "logit"),
           data = df)
dfit_emm3 <- huxreg(fit_emm3,
               coefs = c("RSV infection during the first year of life" = "oy_rsv_infected_devPCR or Serology positive", "Ever breastfeeding" = "EVERBREASTFEDBreast feeding", "Interaction term" = "oy_rsv_infected_devPCR or Serology positive:EVERBREASTFEDBreast feeding"),
                         statistics = c(N = "nobs"),
               tidy_args = list(exponentiate = TRUE),
               ci_level = 0.95,
               error_format = "[{conf.low}, {conf.high}]") %>% 
  set_caption("Effect modification of breastfeeding (odds ratio)") %>% 
  as_flextable() 
dfit_emm3
epi.interaction(fit_emm3,
                coef = c(2,3,4),
                param = "product",
                conf.level = 0.95)
wald.test(Sigma = vcov(fit_emm3), b = coef(fit_emm3), Terms = 4)
# second difference
ame3 <- margins(fit_emm3,
               variables = "oy_rsv_infected_dev",
               at=list(oy_rsv_infected_dev=c("Not","PCR or Serology positive"),
                       EVERBREASTFED=c("Not", "Breast feeding")))
ame_data3 <- as.data.frame(summary(ame3))
vc3 <- vcov(ame3)
diff3 <- ame_data3$AME[2] - ame_data3$AME[1]
se3 <- sqrt((vc3[2,2] + vc3[4,4]) - 2*vc3[4,2])
zstat3 <- diff3/se3
pval3 <- 2*pnorm(-abs(zstat3))
h3 <- as.data.frame(list(Estimate=diff3, SE=se3, Z_score=zstat3, Two_sided_pvalue=pval3))
h3

# Breslow Day Test
fit_bdt3 <- glm(vycurrentasthma_dev ~ oy_rsv_infected_dev+EVERBREASTFED,
           family = binomial(link = "logit"),
           data = df)
BreslowDayTest(tab3, OR = exp(summary(fit_bdt3)[["coefficients"]][1,1]))
```

The logistic regression models could not find any effect modifications
of infant sex or family history of asthma regardless of additive or
multiplicative scale. On the other hand, we found an multiplicative
interaction of breast feeding from the logistic regression. We
calculated marginal effects (the difference of two predicted outcomes as
an absolute scale) and second difference in the two marginal effects
across a subgroup, which showed a significant difference. From a change
from never breastfeeding to breastfeeding, the probability of the child
asthma caused by RSV infection would **decrease 14%**. We performed the
Breslow Day tests of homogeneity, and they found significant results. It
means there might be a effect modification either additive or
multiplicative scale. In total, we determined a breastfeeding might be
an effect modifiers while infant sex and familt history of asthma would
not.

14. Table 4. For at least 5 of your confounders, identify whether the
    confounder is associated with outcome among the unexposed. Hint:
    create a table with crude OR (and 95% CI) for the association
    between that confounder and your outcome among the unexposed
    (include frequencies or means as necessary -- similar to table
    above)

We selected the following confounders: infant sex (male vs. female),
child race/ethnicity (White-non-Hispanic vs. all other ethnic and racial
groups), mode of delivery (vaginal vs. cesarean), maternal marital
status (married vs. single), maternal education, maternal or paternal
asthma status (absent vs. present), and insurance status (Medicaid vs.
all other insurance), breast feeding status, presence of sibling and day
care attendance in the first year of life.

```{r}
# select only binary variables
confounders <- c("sex",
                #"ethnicity",
                "DELIVERYMODE",
                "MAT_MARITAL_STATUS",
                # "MAT_EDUCYEARS",
                "MAT_ASTHMA_EVER",
                #"INSURANCE_CHILD",
                "EVERBREASTFED",
                "DAYCARE_OY")

for (confounder in confounders){
  df_unexp <- df %>% filter(oy_rsv_infected_dev == "Not")
  print(confounder)
  confound_tab <- table(as.integer(unlist(df_unexp[,confounder])), df_unexp$vycurrentasthma_dev)
  print(oddsratio(confound_tab))
}

confounders <- c(#"sex",
                "ethnicity",
                #"DELIVERYMODE",
                #"MAT_MARITAL_STATUS",
                #"MAT_EDUCYEARS",
                #"MAT_ASTHMA_EVER",
                "INSURANCE_CHILD")
                #"EVERBREASTFED",
                #"DAYCARE_OY")

for (confounder in confounders){
  df_unexp <- df %>% filter(oy_rsv_infected_dev == "Not")
  print(confounder)
  confound_tab <- table(as.integer(unlist(df_unexp[,confounder])), df_unexp$vycurrentasthma_dev)
  print(confound_tab)
  print(fisher.test(confound_tab))
}

df_unexp <- df %>% filter(oy_rsv_infected_dev == "Not")
t.test(MAT_EDUCYEARS ~ vycurrentasthma_dev, data = df_unexp)

```

In our analyses, only sex and family history of asthma had a significant
association with child asthma inception. For a change from male to
female, the odds of subsequent child asthma inception increased. For a
change from non-family history of asthma to family history of asthma,
the odds of subsequent child asthma inception increased.

15. Table 5. For at least 5 of your confounders, identify whether the
    confounder is associated with the exposure among the general
    population. Hint: create a table of the crude OR (and 95% CI) for
    the association between that confounder and your exposure among the
    total population (for cohort or cross-sectional studies) or among
    the controls (for case-control studies).

```{r}
confounders <- c("sex",
                #"ethnicity",
                "DELIVERYMODE",
                #"MAT_MARITAL_STATUS",
                # "MAT_EDUCYEARS",
                "MAT_ASTHMA_EVER",
                #"INSURANCE_CHILD",
                "EVERBREASTFED",
                "DAYCARE_OY")

for (confounder in confounders){
  print(confounder)
  confound_tab <- table(as.integer(unlist(df[,confounder])), df$oy_rsv_infected_dev)
  print(oddsratio(confound_tab))
}

confounders <- c(#"sex",
                "ethnicity",
                #"DELIVERYMODE",
                #"MAT_MARITAL_STATUS",
                #"MAT_EDUCYEARS",
                #"MAT_ASTHMA_EVER",
                "INSURANCE_CHILD")
                #"EVERBREASTFED",
                #"DAYCARE_OY")

for (confounder in confounders){
  print(confounder)
  confound_tab <- table(as.integer(unlist(df[,confounder])), df$oy_rsv_infected_dev)
  print(confound_tab)
  print(fisher.test(confound_tab))
  print(fisher.multcomp(confound_tab))
  
}

t.test(MAT_EDUCYEARS ~ oy_rsv_infected_dev, data = df)
```

Delivery mode, day-care use, ethnicity and insurance had a significant
association with RSV infection during the first year of life. For a
change from vaginal to C-section, the odds of subsequent child asthma
inception increased. For a change from non-day-care use to day-care use,
the odds of subsequent child asthma inception increased. Regarding
ethnicity and insurance, they are multiple-comparions and our pairwise
Fisher tests showed only a change from non-hispanic white to
non-hispanic black decreased the odds of subsequent child asthma.

16. Table 6. Depending on the results of questions #14 and #15, decide
    which confounders you should adjust for in the multivariable
    analysis (Hint: confounders should be associated with the outcome
    among the unexposed and associated with the exposure among the
    general population). Present your results in a table and interpret
    the measure of association.

Depending on the questions #14 and #15, none of them might not be
controlled in our analysis. However, we should decide the covariates
theoretically or based on previous literature. Otherwise, we can miss
important confounders in the analysis.

17. Table 7. Using directed acyclic graphs that you constructed as a
    part of your exercises, construct a final DAG for your project.
    Using this DAG, determine the set of confounders that you would
    include in your multivariable model. For effect measure
    modification, feel free to rely on your empiric assessment. Present
    these results in a table and interpret the measure of association.
    Are the variables you chose for confounding in your multivariable
    model based on DAG different than empiric methods you used in the
    questions above? Are the effect estimates between your exposure
    outcome relationship different if you based your variable selection
    based on DAGs vs. empiric method?

We described DAG in the question #5, and address the issue in the
question #16. In our main analysis, we selected clinically important
confounders. Regarding effect modifiers, our analysis found
breastfeeding may be an effect modifier. We included an interaction term
of RSV infection and breastfeeding in the main analysis to improve the
model fitness.

```{r}
fit_crude <- glm(vycurrentasthma_dev ~ oy_rsv_infected_dev + oy_rsv_infected_dev:EVERBREASTFED,
               family = binomial(link = "logit"),
               data = df)
dfit_crude <- huxreg(fit_crude,
               coefs = c("RSV infection during the first year of life" = "oy_rsv_infected_devPCR or Serology positive", "Interaction term" = "oy_rsv_infected_devPCR or Serology positive:EVERBREASTFEDBreast feeding"),
                         statistics = c(N = "nobs"),
               tidy_args = list(exponentiate = TRUE),
               ci_level = 0.95,
               error_format = "[{conf.low}, {conf.high}]") %>% 
  set_caption("Crude odds ratio of RSV infection during the first year of life on child asthma") %>% 
  as_flextable() 
dfit_crude

fit_crude_marg <- margins(fit_crude,
                    variables = "oy_rsv_infected_dev")
summary(fit_crude_marg)
```

```{r}
fit_adj <- glm(vycurrentasthma_dev ~ oy_rsv_infected_dev + sex + oy_rsv_infected_dev:EVERBREASTFED,
               family = binomial(link = "logit"),
               data = df)
dfit_adj <- huxreg(fit_adj,
               coefs = c("RSV infection during the first year of life" = "oy_rsv_infected_devPCR or Serology positive", "Interaction term" = "oy_rsv_infected_devPCR or Serology positive:EVERBREASTFEDBreast feeding", "Male"="sexMale"),
                         statistics = c(N = "nobs"),
               tidy_args = list(exponentiate = TRUE),
               ci_level = 0.95,
               error_format = "[{conf.low}, {conf.high}]") %>% 
  set_caption("Adjusted odds ratio of RSV infection during the first year of life on child asthma") %>% 
  as_flextable() 
dfit_adj

fit_marg <- margins(fit_adj,
                    variables = "oy_rsv_infected_dev")
summary(fit_marg)
```

18. In one or two paragraphs, briefly discuss whether your dataset
    provides adequate information to answer your research question. Show
    evidence in terms of a) number of participants with analyzable data
    for the exposure, outcome, and confounders, b) quality of exposure
    and outcome assessment, and c) how your measurements conform to the
    generally agreed upon standards for your exposure or outcome

The INSPIRE cohort is a population-based birth cohort that enrolled
about 1,950 unique dyads of infant and mother prospectively, and has
only a small number of missing data about baseline characteristics.
Regarding exposure variables, we use RSV infection during the first year
detected by PCR or serology because we can easily obtain PCR results
during the first year and serology results at 1-year follow-up.
Regarding outcome variables, we had about 30% of missing data in the
five-year current asthma due to loss of folow-up. However, as shown
below, there were not large differences among those who completed and
those lost-to-follow-up participants. In addition, the INSPIRE cohort
has multiple short-term outcomes such as recurrent wheeze for increased
sample size and power in regression analyses. Thus we can perform some
sensitivity analyses to evaluate the validity of our main analysis. The
participants' data were collected by skilled-staffs, and the quality was
adequate and met the general standard. Regarding participant's
characteristics, we combined the information of electronic medical
record, administrative data, and questionnaires. Regarding the exposure
variables, we collected RSV serology at 1-year follow-up in addition to
RSV PCR at illness visits. The specificity of PCR is quite high while
the sensitivity is moderate [@falsey2002]. We supplement this limitation
by serology results at 1-year follow-up. Serology is considered the best
for diagnosis in epidemiology study, but the sensitivity is not perfect
[@falsey2002]. There might be some measurement error, especially when
examined long after a RSV infection. Regarding the outcomes variables,
there may be inter- and intra-observer variablity [@islam]. However, we
selected multiple valid outcome scales based on the information both
from parents and physicians.

```{r}
df <- df %>% 
  mutate(vycurrentasthma_dev_mis = if_else(is.na(vycurrentasthma_dev), 0, 1),
         vycurrentasthma_dev_mis = factor(vycurrentasthma_dev_mis, levels = c(0,1), labels = c("Missing of five-year current asthma", "Non-missing"))) 
         
table2 <- CreateTableOne(vars = vars,
                         data = df,
                         includeNA = FALSE,
                         factorVars = factorVars,
                         strata = "vycurrentasthma_dev_mis")
table2 %>% 
  print() %>% 
  write.csv(here("output/table2.csv"))
```

```{r}
dvars2 <- df %>% 
  select(enroll_age, sex, ethnicity, MAT_EDUC_cat, MAT_MARITAL_STATUS, INSURANCE_CHILD, GESTAGEWK,
         BIRTHWEIGHT_GRAM, DELIVERYMODE, EVERBREASTFED, DAYCARE_OY, other_sib_cat, oy_rsv_infected_dev,
         vy_rec_whz_dev) %>%
  colnames()
dfactorVars2 <- df %>% 
  select(enroll_age, sex, ethnicity, MAT_EDUC_cat, MAT_MARITAL_STATUS, INSURANCE_CHILD, GESTAGEWK,
         BIRTHWEIGHT_GRAM, DELIVERYMODE, EVERBREASTFED, DAYCARE_OY, other_sib_cat, oy_rsv_infected_dev,
         vy_rec_whz_dev) %>%
  select(where(is.factor)) %>% 
  colnames()

dtable2 <- CreateTableOne(vars = dvars2,
                         data = df,
                         includeNA = FALSE,
                         factorVars = dfactorVars2,
                         strata = "vycurrentasthma_dev_mis")
dtable2 %>% 
  print(test = FALSE, contDigits = 1, catDigits = 1) %>% 
  as.data.frame() %>% 
  mutate("Variables" = c("Number of infants", "Age at enrollment (month)",
                    "Male sex", 
                    "Ethnicity", "\t Non-hispanic White", "\t Non-hispanic balck", "\t Hispanic and other",
                    "Maternal education", "\t Less than high school/general educational development",
                    "\t High school/general educational development",
                    "\t More than High school/general educational development",
                    "Maternal marital status", "Single",
                    "\t Married", "\t Divorces/Separated",
                    "Insurance of infant", "\t Medicaid", "\t Private", "\t Self-Pay", "\t None", "\t Other",
                    "Gestational age (weeks)", "Birth weight", 
                    "Birth by cesarean section", "Daycase use furing the first year", "Ever any breastfeeding",
                    "Presence of biological siblings", "\t None", "\t One sibling", "\t Two or more Siblings",
                    "RSV infection detected by PCR or serology during the first year",
                    "Five-year current asthma")) %>% 
  select(Variables, everything()) %>% 
  regulartable() %>% 
  theme_booktabs() %>% 
  autofit()
```

19. In one or two paragraphs, discuss whether or not your study design
    is adequate for testing your hypothesis. If not what are the
    limitations (Consider the following factors: study design, sample
    size, sampling methods, statistical analysis methods, data
    collection techniques, selection of reference population and any
    control populations, if appropriate)? What could be done better in a
    future study? (Note: please suggest something other than a
    randomized clinical trial).
20. In one or two paragraphs, discuss the specific strengths in you
    study (Consider the following factors: uniqueness of your database,
    study design, sample size, sampling methods, statistical methods,
    data collection techniques, selection of reference population and
    any control populations, if appropriate)?

The INSPIRE cohort would be adequate for drawing a conclusion on the
research question "is RSV infection during the first year of life
compared with infection after the first year of life associated with the
greater risk of subsequent child asthma inception". To date, it is
unclear whether age at first RSV infection confers variable risk for
subsequent child asthma inception. This would be important if delaying
the first infection were a method of preventing asthma development.\
Our systematic review revealed age of infection betwee 3-6 months of age
might confer the highest risk, however, these studies all assessed
severe RSV infection, not all types of RSV infection. Previous
observational studies also had severe issues of bias such as measurement
error of RSV infection and asthma outcome, as well as many unmeasured
confounding factors. In particular, shared genetic predisposition to
both severe RSV infection and child asthma inception is likely a major
confounding factor when defining the exposure of interest as a clinical
phenotype of RSV infection rather than an exposure, only severe
infection [@brunwasser2020a]. The unique design of the INSPIRE cohort
was to represent the complete spectrum (mild to severe) of RSV
infection, instead of only severe RSV infection, to overcome the
confounding effect of genetic predisposition to both severe RSV
infection and child asthma inception. In addition, we ascertained for
major relevant potential confounders. The INSPIRE study would be
adequate to address our research question. Our study would overcome the
limitations in previous studies.

21. Make a final determination on whether or not you think your study is
    feasible. Explain your answer and suggest if there is a need to
    modify your research question or obtain an alternative dataset.

Our study is feasible and suitable for identifying the effect of timing
of RSV infection on asthma risk.

**Reference**

[@binns2022; @brunwasser2020; @brunwasser2020a; @coutts2020;
@coutts2020a; @islam; @larkin2015; @piedimonte2014; @piedimonte2014a;
@shi2020]
