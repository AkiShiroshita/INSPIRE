---
title: "Assignment 2"
author: "Akihiro Shiroshita"
date: "2022-10-20"
output: word_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
	echo = TRUE,
	message = FALSE,
	warning = FALSE
)

packages = c("devtools",
             "usethis",
             "readr",
             "readxl",
             "tidyverse",
             "tidylog",
             "lubridate",
             "ggplot2",
             "ggplotgui",
             "ggthemes",
             "arsenal",
             "naniar",
             "VIM")
package.check <- lapply(packages, FUN = function(x){
  if (!require(x, character.only = TRUE)){
    install.packages(x, dependencies = TRUE)
    library(x, character.only = TRUE)
  }
})
```

Epidemiology Methods and Theory I

1.  Restate your research question in the form of a testable hypothesis

**Research question**

Is the age at the first respiratory syncytial virus (RSV) infection associated with the risk of subsequent child asthma inception?

2.  In one or two paragraphs, state the study design for this specific project (this may be different from the design for the parent study). Be sure to describe the study population in terms of inclusion and exclusion criteria. Additionally, include any information about how participants were sampled/recruited, if applicable.

**Study design**

Our study will be based on the prospective population-based birth cohort study recruited from the middle Tennessee region of the southeastern United States, the Infant Susceptibility to Pulmonary Infections and Asthma Following RSV Exposure (INSPIRE) study. The INSPIRE cohort consists of nearly 2,000 term and healthy infants followed from early infancy through 6 years of age. RSV was defined through biweekly surveillance during the first year of life, and asthma was defined at age 5-6 years. Detailed methods have been previously published(9). The current study was approved by the Institutional Review Board at Vanderbilt University Medical Center. Written informed consent was provided by a parent or legal guardian of an infant participant . We will report the study results according to the Strengthening the Reporting of Observational Studies in Epidemiology (STROBE) Statement (10). The INSPIRE study was funded by a National Institute of Allergy and Infectious Diseases (NIAID) Asthma and Allergic Diseases Cooperative Research Center (AADCRC) grant.

**Study participants**

INSPIRE study participants were recruited from regional pediatric practices. Inclusion criteria were singleton birth; an infant who was born between June and December of 2012 and 2013; term birth ≥37 weeks; birth weight ≥2250 g (5 lbs); no intention of relocating from area within 5 years. The restriction to birth months of June through December was so that each infant would be on average 6 months of age or less entering their first RSV season. The unique design of this population-based cohort was to represent the complete spectrum (mild to severe) of RSV infection, instead of only severe RSV infection, to overcome the confounding effect of genetic predisposition to both severe RSV infection and child asthma inception. Exclusion criteria were mechanical ventilation before enrolment, receipt of RSV immunoprophylaxis and significant medical co-morbidities.

3.  In one paragraph, describe the exposure assessment and how it will be analyzed. For the purposes of this assignment, you should use either a dichotomous or categorical exposure variable. If your original exposure variable was continuous and you categorized it, what cut-points did you use to categorize your variables and why did you choose those cut points?

**Exposure**

For evaluating the association between age at the first RSV infection and the outcomes, we restricted to RSV-infected participants who were detected by nasal PCR to define infant age of infection in the first year of life, and children who were RSV PCR negative and RSV serology negative at age 1-year as RSV infected after age one.

4.  In one paragraph, describe the outcome assessment and how it will be analyzed. For the purposes of this assignment, you should use a dichotomous outcome variable. If the outcome is continuous or categorical, state how you decided to dichotomize it into the groups you chose.

**Outcome**

Current asthma at 5 years was defined by both 1) physician diagnosis by 5 years and 2) parental report of symptoms, systemic steroid use, or healthcare utilization for asthma in prior 12 months. Annual recurrent wheeze at 2,3,4 years was defined as parental report of ≥2 wheezing episodes since the child's last birthday.

5.  Based on your literature review and any other substantive knowledge you have of the subject, list the potential confounders and effect modifiers you think should be included in the analysis of your exposure and outcome. Indicate whether all these confounders and modifiers are available in your dataset.

**Covariates**

Models were adjusted for the covariates chosen a priori based on their clinical relevance as confounders or risk factors. Covariates included infant sex (male vs. female), child race/ethnicity (White-non-Hispanic vs. all other ethnic and racial groups), mode of delivery (vaginal vs. cesarean), maternal marital status (married vs. single), maternal education, maternal asthma status (absent vs. present), and insurance status (Medicaid vs. all other insurance), breast feeding status, presence of sibling and day care attendance in the first year of life.

6.  Label all the variables in your dataset.
7.  For all categorical or dichotomous variables, add value labels for all groups.


```{r}
df <- read_csv("analysis_data.csv")

df %>% glimpse()
```

8.  Is there missing data in your dataset? If so, explain how missing values are coded and how they will be handled in the analysis. Summarize interesting missing data patterns.

```{r}
# participants' baseline characteristics  

baseline <- df %>% 
  select(STUDYENROLLDATE, INFANTDOB, sex, ethnicity,
         GESTAGEWK, BIRTHWEIGHT_GRAM, MATSMOKE_PREG, DAYCARE_OY,
         MAT_ASTHMA_EVER, PAT_ASTHMA_EVER, MAT_BMI_PREPREG,
         EVERBREASTFED, BREASTFEDDUR, DELIVERYMODE, MAT_EDUCYEARS,
         MAT_MARITAL_STATUS, INSURANCE_CHILD, OTHERLIVSIBS_BIO,
         OTHERLIVSIBS_HAL, HOUSEHOLDSIZE, residence6mo)
aggr(baseline, prop = TRUE)

# exposure

exposure <- df %>% 
  select(anyrsv_dev, rftodaydate, oy_rsv_infected_dev, rsv_exposed_dev)
aggr(exposure, prop = FALSE, number = TRUE, labels = names(expo))

# outcome  

outcome <- 

```
**Missing data**
INSPIRE cohort had only small percent of missing data in participants' baseline characteristics. Regarding outcomes, 
For infants with RSV PCR positive we used the age at specimen collection. For infants or children for which age of RSV infection is not ascertained but known to be serology positive or negative we drew randomly from the appropriate age interval distribution [serology positive: enrollment age (in months)  ≤ age ≤12 months; and serology negative: 12 to 36 months] and assign the imputed value for analysis.   

9.  Table 0. Create a list of all the variables in your dataset, including exposure, outcome, covariates, confounders and effect modifiers. Include the following:

```{=html}
<!-- -->
```
a.  Variable name
b.  Variable label
c.  Variable type (continuous, categorical, dichotomous)
d.  Range for continuous variables OR unique values and value labels for categorical and dichotomous variables
e.  Percent missing

```{=html}
<!-- -->
```
10. Create histograms for all continuous variables. Comment on outliers, skewed distributions (and whether/what transformation may be necessary)

11. Table 1. Create a table with categories of your main exposure variable as the columns. If your study design is cohort or cross-sectional include all participants in your study, otherwise use only controls if your study is a case-control study. Compute descriptive statistics (frequencies and proportion for categorical variables and mean ± SD for continuous variables) for all potential confounders by categories of your main exposure.

12. Table 2. Calculate the crude measure of association (including 95% confidence intervals) between your exposure and outcome. Interpret this association. How did you arrive at your chosen reference group?

13. Table 3. Identify one variable that could be an effect modifier of the association between your exposure and outcome. Present stratum measures of association (including 95% confidence intervals), stratified by the potential effect measure modifier. Include frequencies. Calculate the Breslow Day test of homogeneity (Table 3a). In addition, present the findings using a single referent group using the doubly unexposed as the referent group (Table 3b). Interpret the measures of association and comment on the potential for effect modification.

14. Table 4. For at least 5 of your confounders, identify whether the confounder is associated with outcome among the unexposed. Hint: create a table with crude OR (and 95% CI) for the association between that confounder and your outcome among the unexposed (include frequencies or means as necessary -- similar to table above)

15. Table 5. For at least 5 of your confounders, identify whether the confounder is associated with the exposure among the general population. Hint: create a table of the crude OR (and 95% CI) for the association between that confounder and your exposure among the total population (for cohort or cross-sectional studies) or among the controls (for case-control studies).

16. Table 6. Depending on the results of questions #14 and #15, decide which confounders you should adjust for in the multivariable analysis (Hint: confounders should be associated with the outcome among the unexposed and associated with the exposure among the general population). Present your results in a table and interpret the measure of association.

17. Table 7. Using directed acyclic graphs that you constructed as a part of your exercises, construct a final DAG for your project. Using this DAG, determine the set of confounders that you would include in your multivariable model. For effect measure modification, feel free to rely on your empiric assessment. Present these results in a table and interpret the measure of association. Are the variables you chose for confounding in your multivariable model based on DAG different than empiric methods you used in the questions above? Are the effect estimates between your exposure outcome relationship different if you based your variable selection based on DAGs vs. empiric method?

18. In one or two paragraphs, briefly discuss whether your dataset provides adequate information to answer your research question. Show evidence in terms of a) number of participants with analyzable data for the exposure, outcome, and confounders, b) quality of exposure and outcome assessment, and c) how your measurements conform to the generally agreed upon standards for your exposure or outcome

19. In one or two paragraphs, discuss whether or not your study design is adequate for testing your hypothesis. If not what are the limitations (Consider the following factors: study design, sample size, sampling methods, statistical analysis methods, data collection techniques, selection of reference population and any control populations, if appropriate)? What could be done better in a future study? (Note: please suggest something other than a randomized clinical trial).

20. In one or two paragraphs, discuss the specific strengths in you study (Consider the following factors: uniqueness of your database, study design, sample size, sampling methods, statistical methods, data collection techniques, selection of reference population and any control populations, if appropriate)?

21. Make a final determination on whether or not you think your study is feasible. Explain your answer and suggest if there is a need to modify your research question or obtain an alternative dataset.
